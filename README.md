This is a suite of tools for processing teletext signals recorded on VHS, as
well as tools for processing teletext packet streams. The software has only
been tested with bt8x8 capture hardware, but should work with any VBI capture
hardware with appropriate configuration.

This is the second rewrite of the original software. The old versions are
still available in the `v1` and `v2` branches of this repo, or from the
releases page.

You can see my collection of pages recovered with this software at:

https://al.zerostem.io/~al/teletext/

And more at:

http://archive.teletextarchaeologist.org

And:

http://archive.teletextart.co.uk/

INSTALLATION
------------

In order to use CUDA decoding you need to use the Nvidia proprietary driver.

To install with optional dependencies run:

    pip3 install -e .[CUDA,spellcheck,viewer]

If CUDA or pyenchant are not available for your platform simply omit them
from the install command.

In order for the output to be rendered correctly you need to use a specific
font and terminal:

    sudo apt-get install tv-fonts rxvt-unicode

Then enable bitmap fonts in your X server:

    cd /etc/fonts/conf.d
    sudo rm 70-no-bitmaps.conf
    sudo ln -s ../conf.avail/70-yes-bitmaps.conf .

After doing this you may need to reboot.

Finally open a terminal with the required font:

    urxvt -fg white -bg black -fn teletext -fb teletext -geometry 41x25 +sb &


USAGE
-----

First capture VBI from VHS:

    teletext record -d /dev/vbi0 > capture.vbi

Deconvolve the recording:

    teletext deconvolve capture.vbi > stream.t42

Examine the headers to find services on the tape:

    teletext filter -r 0 stream.t42

Split capture into services:

    teletext filter --start <N> --stop <N> stream.t42 > stream-1.t42

Display all copies of a page in a stream:

    teletext filter stream.t42 -p 100

Squash duplicate subpages, which reduces errors:

    teletext squash stream.t42 > output.t42

Generate HTML pages from a stream:

    teletext html output/ stream.t42 

Interactively view the pages in a t42 stream:

    teletext service stream.t42 | teletext interactive

In the interactive viewer you can type page numbers, or '.' for hold.

Run each command with '--help' for a complete list of options.

HARDWARE SETUP
--------------

For the capture BT8x8, CX88 and some cards with SAA chips can be used.
It is also possible to decode from TBC files generated by the
vhs / ld-decode project. As the mentioned cards are pretty old they
originally are only available as PCI cards second-hand. But on aliexpress
BT8x8 and CX88 aka CX23880/1/2/3 can be found having a PCI-E interface.

BT878
https://de.aliexpress.com/item/1005003017060682.html
https://de.aliexpress.com/item/1005003016832549.html

CX23880/1/2/3
https://www.aliexpress.com/item/1005003461248897.html
https://www.aliexpress.com/item/1005003092946304.html
https://www.aliexpress.com/item/4001286595482.html

As VCRs, models are preferable where picture settings can be adjusted manually.
VCRs using automatic sharpening and noise filters can destroy the teletext signal.
VCRs with a good chance to put out a decodeable teletext signal are e.g.
NV-FS200, NV-FS88 from Panasonic and possible other VCRs of this model line. They
have a manual picture quality slider that most of the time has to be slided to the
far left, letting the picture look blurry, but make teletext decode better.

There are several other models from other brands that work as well. Try by yourself.
The list will be updated when further information is available. 

PREPARATION
-----------

To be able to check the settings of the capture-card install the v4l2 tools
    
    sudo apt install qv4l2

Then open that tool and select input, colormode and resolution and hit play.
This will set the parameters and open a tv window and displays video.
In most cases it is a good idea to stop the playback again, as it can
interfere with the teletext capture.  

Before capturing any teletext data from vbi it is a good idea to tune to best
decodeable teletext. You can use vbiview to do this. Vbiview can directly read
from the device which usually is the capture device.

    teletext vbiview /dev/vbi0

Then check the displayed lines. Green lines are the ones recognized as teletext.
By clicking on them they are live deconvolved to stdout aka the terminal window.
Tune your VCR for the best decode you can get. So the better you tune your
VCR, the better a line is readable. This can take a while.
Also it can be, that it differs from tape to tape. Especially longplay recordings
are tricky and it can be a hit or miss to be able to deconvolve them.
Sometimes non teletext data is recognized as teletext. There is no solution to it
yet, only a workaround. To omit lines from deconvolve, the raw VBI stream has to
be edited in an editor like virtualdub2 and the miss-detected lines be overpainted
with black.

TROUBLESHOOTING
---------------

Garbled deconvolve:
If deconvolve or vbiview gives you only garbled output, with sometimes one
or two lines readable, it could be that it was compiled with a too old version
of numpy installed.
In a test-case numpy 1.17.4 was not compatible with the teletext tool. It might be,
that numpy has to be at least 1.18. It was successfully tested with e.g. numpy 1.21.5.
So if you experience that behaviour, uninstall numpy and install a newer version of it.
It can be, that you also have to reinstall miniaudio, spectrum, watchdog. Just install
them again and recompile vhs-teletext.

Detuned capture-card:
It happens, that the capture-card starts to forget brigthness and contrast settings and
starts to drift towards ultra bright. This can be avoided by starting and stopping
playback approx. every 10 minutes in the v4l2 tools while recording teletext.
To test that beahvior let vbiview run for 20 to 30 minutes and check if the vbi lines
get more and more bright and become unrecognizeable. If so, start play in v4l2 while
vbiview is open. It should jump back to correct brightness levels and teletext is
recognized again.
